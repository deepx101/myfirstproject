<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Schedule</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <header class="top-nav">
        <h2>Create Meeting</h2>
        <a href="{{ url_for('faculty_dashboard') }}" class="back-btn">‚Üê Back</a>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </header>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <ul>
                <li><a href="{{ url_for('create_schedule') }}" class="active">Create Schedule</a></li>
                <li><a href="{{ url_for('my_schedule') }}">My Schedule</a></li>
                <li><a href="{{ url_for('department_calendar') }}">Department Calendar</a></li>
                <li><a href="{{ url_for('profile') }}">Profile</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <h3>Schedule a New Meeting</h3>

            {% if error %}
            <div class="error-message" style="white-space: pre-wrap;">{{ error }}</div>
            {% endif %}

            {% if success %}
            <div class="success-message">{{ success }}</div>
            {% endif %}

            <form method="POST" class="form-container">
                <div class="form-group">
                    <label>Meeting Title</label>
                    <input type="text" name="meeting_title" required>
                </div>

                <div class="form-group">
                    <label>Date</label>
                    <input type="date" name="meeting_date" required>
                </div>

                <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" name="start_time" required>
                </div>

                <div class="form-group">
                    <label>End Time</label>
                    <input type="time" name="end_time" required>
                </div>

                <div class="form-group">
                    <label>Venue</label>
                    <input type="text" name="venue" required>
                </div>

                <div class="form-group">
                    <label>Department</label>
                    <select name="department_id" required>
                        <option value="">-- Select Department --</option>
                        {% for dept in departments %}
                        <option value="{{ dept.department_id }}">{{ dept.department_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>Select Participants</label>
                    <input type="text" id="searchMember" placeholder="üîç Search member by name, email, userid, mobile, or department">
                    <div class="participant-box" id="memberList">
                        {% for member in members %}
                        <div class="participant-item">
                            <label>
                                <input type="checkbox" name="participants" value="{{ member.user_id }}">
                                <h3>{{ member.user_name }}</h3>
                                User ID: {{ member.user_id }}<br>
                                <div class="department">Dept: {{ member.department_name }}</div>
                                <div class="mobile">Mobile No: {{ member.user_mobileNo or 'N/A' }}</div>
                                <div class="email">Email: {{ member.email }}</div>
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <button type="submit" class="submit-btn">Create Meeting</button>
            </form>
        </main>
    </div>

    <script>
        // Sidebar toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');

        if (localStorage.getItem('sidebarCollapsed') === 'true') {
            sidebar.classList.add('collapsed');
            document.body.classList.add('sidebar-collapsed');
            sidebarToggle.classList.add('active');
        }

        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');
            document.body.classList.toggle('sidebar-collapsed');
            this.classList.toggle('active');
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        });

        // ‚úÖ Improved Search Functionality
        const searchInput = document.getElementById("searchMember");
        const members = document.querySelectorAll(".participant-item");

        searchInput.addEventListener("keyup", function () {
            const value = this.value.toLowerCase();

            members.forEach(member => {
                const userName = member.querySelector("h3")?.textContent.toLowerCase() || "";
                const userId = member.querySelector("input[type='checkbox']")?.value.toLowerCase() || "";
                const department = member.querySelector(".department")?.textContent.replace("Dept:", "").trim().toLowerCase() || "";
                const mobile = member.querySelector(".mobile")?.textContent.replace("Mobile No:", "").trim().toLowerCase() || "";
                const email = member.querySelector(".email")?.textContent.replace("Email:", "").trim().toLowerCase() || "";

                if (
                    userName.includes(value) ||
                    userId.includes(value) ||
                    department.includes(value) ||
                    mobile.includes(value) ||
                    email.includes(value)
                ) {
                    member.style.display = "block";
                } else {
                    member.style.display = "none";
                }
            });
        });
    </script>
</body>
</html>
